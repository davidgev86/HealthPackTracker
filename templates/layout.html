<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}HPM Inventory Tracker{% endblock %}</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet" id="bootstrap-theme-css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet" crossorigin="anonymous">
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet">
    <style>
        /* Consistent font family across all themes */
        * {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", "Noto Sans", "Liberation Sans", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji" !important;
        }
        
        /* Navigation responsive fixes */
        .navbar-nav .nav-link {
            white-space: nowrap;
            padding: 0.5rem 0.75rem;
        }
        
        @media (max-width: 1200px) {
            .navbar-nav .nav-link {
                font-size: 0.9rem;
                padding: 0.4rem 0.6rem;
            }
        }
        
        @media (max-width: 992px) {
            .navbar-nav .nav-link {
                font-size: 0.85rem;
                padding: 0.4rem 0.5rem;
            }
        }
        
        /* Language toggle positioning */
        #langToggle {
            min-width: 60px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('inventory') }}">
                <i class="fas fa-warehouse me-2"></i>HPM Inventory
            </a>
            
            <!-- Theme and Language Toggle Buttons -->
            <div class="d-flex gap-2 me-3">
                <button class="btn btn-outline-light btn-sm" onclick="toggleTheme()" id="themeToggle" title="Switch to Light Mode">
                    <i class="fas fa-sun" id="themeIcon"></i>
                </button>
                <button class="btn btn-outline-light btn-sm" onclick="toggleLanguage()" id="langToggle" title="Switch to Spanish">
                    <i class="fas fa-language me-1"></i><span data-en="ES" data-es="EN">ES</span>
                </button>
            </div>
            
            {% if session.username %}
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('hpm_items') }}" data-en="HPM Items" data-es="HPM">
                            <i class="fas fa-star me-1"></i>HPM Items
                        </a>
                    </li>
                    {% if session.role in ['admin', 'manager'] %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('vendors') }}" data-en="Vendors" data-es="Proveedores">
                            <i class="fas fa-truck me-1"></i>Vendors
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('categories') }}" data-en="Categories" data-es="CategorÃ­as">
                            <i class="fas fa-tags me-1"></i>Categories
                        </a>
                    </li>
                    {% endif %}

                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('waste_log') }}" data-en="Waste Log" data-es="Desperdicios">
                            <i class="fas fa-trash me-1"></i>Waste Log
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('weekly_waste_reports') }}" data-en="Weekly Reports" data-es="Reportes">
                            <i class="fas fa-chart-line me-1"></i>Weekly Reports
                        </a>
                    </li>
                    {% if session.role in ['admin', 'manager'] %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('import_export') }}" data-en="Import/Export" data-es="Importar">
                            <i class="fas fa-file-import me-1"></i>Import/Export
                        </a>
                    </li>
                    {% endif %}
                </ul>
                
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user me-1"></i>{{ session.username }} ({{ session.role.title() }})
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="{{ url_for('logout') }}" data-en="Logout" data-es="Salir">
                                <i class="fas fa-sign-out-alt me-1"></i>Logout
                            </a></li>
                        </ul>
                    </li>
                </ul>
            </div>
            {% endif %}
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        {% if error_message %}
            <div class="alert alert-danger" role="alert">
                {{ error_message }}
            </div>
        {% endif %}

        {% block content %}{% endblock %}
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-light py-3 mt-5">
        <div class="container text-center">
            <small>&copy; 2025 Health Pack Meals - Inventory Management System</small>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Language Toggle Script -->
    <script>
        let currentLanguage = 'en';
        
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'es' : 'en';
            
            // Update all elements with data-en and data-es attributes
            document.querySelectorAll('[data-en][data-es]').forEach(element => {
                const text = element.getAttribute('data-' + currentLanguage);
                if (text) {
                    // Preserve HTML structure while updating text content
                    const innerHTML = element.innerHTML;
                    const iconMatch = innerHTML.match(/<i[^>]*>.*?<\/i>/);
                    const spanMatch = innerHTML.match(/<span[^>]*>.*?<\/span>/);
                    const icon = iconMatch ? iconMatch[0] + ' ' : '';
                    
                    // Handle elements with spans for translation
                    if (spanMatch) {
                        element.innerHTML = innerHTML.replace(spanMatch[0], text);
                    } else {
                        element.innerHTML = icon + text;
                    }
                }
            });
            
            // Update placeholder texts
            document.querySelectorAll('[data-placeholder-en][data-placeholder-es]').forEach(element => {
                const placeholder = element.getAttribute('data-placeholder-' + currentLanguage);
                if (placeholder) {
                    element.placeholder = placeholder;
                }
            });
            
            // Update select option texts
            document.querySelectorAll('option[data-en][data-es]').forEach(option => {
                const text = option.getAttribute('data-' + currentLanguage);
                if (text) {
                    option.textContent = text;
                }
            });
            
            // Update modal titles
            document.querySelectorAll('.modal-title[data-en][data-es]').forEach(title => {
                const text = title.getAttribute('data-' + currentLanguage);
                if (text) {
                    const innerHTML = title.innerHTML;
                    const iconMatch = innerHTML.match(/<i[^>]*>.*?<\/i>/);
                    const icon = iconMatch ? iconMatch[0] + ' ' : '';
                    title.innerHTML = icon + text;
                }
            });
            
            // Update table headers
            document.querySelectorAll('th[data-en][data-es]').forEach(th => {
                const text = th.getAttribute('data-' + currentLanguage);
                if (text) {
                    th.textContent = text;
                }
            });
            
            // Update button text and title
            const langButton = document.getElementById('langToggle');
            const langSpan = langButton.querySelector('span');
            langSpan.textContent = currentLanguage === 'en' ? 'ES' : 'EN';
            langButton.title = currentLanguage === 'en' ? 'Switch to Spanish' : 'Switch to English';
            
            // Save language preference
            localStorage.setItem('preferredLanguage', currentLanguage);
        }
        
        // Load saved language preference on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedLanguage = localStorage.getItem('preferredLanguage');
            if (savedLanguage && savedLanguage !== currentLanguage) {
                toggleLanguage();
            }
            
            // Load saved theme preference
            const savedTheme = localStorage.getItem('preferredTheme') || 'dark';
            if (savedTheme === 'light') {
                setLightMode();
            } else {
                setDarkMode();
            }
        });
        
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-bs-theme');
            
            if (currentTheme === 'dark') {
                setLightMode();
                localStorage.setItem('preferredTheme', 'light');
            } else {
                setDarkMode();
                localStorage.setItem('preferredTheme', 'dark');
            }
        }
        
        function setLightMode() {
            const html = document.documentElement;
            const navbar = document.querySelector('.navbar');
            const themeIcon = document.getElementById('themeIcon');
            const themeButton = document.getElementById('themeToggle');
            const langButton = document.getElementById('langToggle');
            const bootstrapCSS = document.getElementById('bootstrap-theme-css');
            
            html.setAttribute('data-bs-theme', 'light');
            // Keep navbar dark for contrast
            navbar.className = 'navbar navbar-expand-lg navbar-dark bg-dark';
            themeIcon.className = 'fas fa-moon';
            themeButton.className = 'btn btn-outline-light btn-sm';
            langButton.className = 'btn btn-outline-light btn-sm';
            themeButton.title = 'Switch to Dark Mode';
            bootstrapCSS.href = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css';
        }
        
        function setDarkMode() {
            const html = document.documentElement;
            const navbar = document.querySelector('.navbar');
            const themeIcon = document.getElementById('themeIcon');
            const themeButton = document.getElementById('themeToggle');
            const langButton = document.getElementById('langToggle');
            const bootstrapCSS = document.getElementById('bootstrap-theme-css');
            
            html.setAttribute('data-bs-theme', 'dark');
            navbar.className = 'navbar navbar-expand-lg navbar-dark bg-dark';
            themeIcon.className = 'fas fa-sun';
            themeButton.className = 'btn btn-outline-light btn-sm';
            langButton.className = 'btn btn-outline-light btn-sm';
            themeButton.title = 'Switch to Light Mode';
            bootstrapCSS.href = 'https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css';
        }
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
